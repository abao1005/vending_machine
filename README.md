# 會打的小孩有糖吃
「微算機原理與應用」課程之期末專題  
應用 PIC18F4520 晶片與 MPLAB xc8 compiler 製作的打地鼠遊戲 x 自動販賣機

## 動機
小時候，貪玩又愛吃，喜歡邊吃糖果邊玩遊戲機，  
而長大之後，課業壓力大，需要輕鬆的小遊戲紓壓，也需要吃甜食補充能量、得到快樂，  
我們結合打地鼠遊戲和迷你糖果機的設計在紓緩壓力、放鬆心情的同時，還能懷念童年時光！

## 功能與原理說明
### 功能  
在指定時間內打到一定數量的地鼠，即贏得遊戲，贏家可以從迷你糖果販賣機隨機得到一包糖果。
### 原理
* 打地鼠遊戲  
用 LED 矩陣顯示地鼠，並用搖桿及按鈕打地鼠。  
點矩陣及搖桿分別是視覺暫留及ADC實作，其上方的七段顯示器，分別可顯示出當前的時間及分數。  
* 遊戲輸贏顯示螢幕  
用 LED 矩陣顯示輸或贏的動畫，未滿10分將顯示FAIL,超過10分則透過return進入獎勵階段。
* 迷你糖果機  
當打地鼠遊戲回傳勝利後，透過輪流輸出1或2或4到LATD製造出三顆LED燈閃爍的效果(供玩家選糖)，當接收到按鈕訊號為1時(pull-down resistor)，LED燈停止閃爍，並回傳LATD/2的值(0或1或2號燈)，此時相對應的步進馬達會開始旋轉。  
步進馬達的原理是透過四個方向的線圈輪流通電，吸引馬達中心的磁鐵，驅使馬達轉動。  
步進馬達有三種旋轉方式：一相激磁、二相激磁、一/二相激磁，其差別在於每次通電的線圈數。  
此專案使用二相激磁的方式，因為考量到要承載餅乾及衣架螺旋的重量，需要比較大的轉速。  
兩個糖果軌道下都有紅外線感測器，當偵測到掉落的糖果，紅外線感測器輸出變為0，回傳馬達後，馬達停止旋轉，並重啟遊戲。  

## 系統流程
<img src="https://github.com/abao1005/vending_machine/blob/main/picture/workflow.png" alt="Cover" width="40%"/>  

## 系統開發工具、材料與技術  

### 開發工具  
MPLAB XC8  
### 材料  
* PIC18F4520晶片*1
* 麵包板*2
* 四位數七段顯示器*1
* 8x8 LED點矩陣*1
* 紅外線避障器*2
* 5V步進馬達*3
* 馬達驅動版*3
* 按鈕*1
* 搖桿*1
* LED燈*3
* 杜邦線若干條
* 220Ω 100Ω電阻若干條
### 技術  
* 四位數七段顯示器(Timer)
* 搖桿及其按鈕(ADC)
* 8*8點矩陣(視覺暫留動畫）
* 紅外線避障器距離感知
* 步進馬達轉速調整
* 於扭力不足之馬達上實現可運行之旋轉機關

## Demo 影片  

<a href="https://youtu.be/LyKamEJr3K4" target="_blank"><img src="https://github.com/abao1005/vending_machine/blob/main/picture/appearance.jpg" 
alt="Demo影片" width="360" height="270" border="10" /></a>
